name: Re-enable Disabled Workflows

on:
  schedule:
    - cron: "0 2 * * *" # Daily
  workflow_dispatch:
    inputs:
      workingOrgs:
        description: 'Comma-separated orgs to scan'
        default: 'nntthuy-axonivy'

jobs:
  reenable:
    runs-on: ubuntu-latest

    steps:
      - name: Re-enable workflows
        env:
          GH_TOKEN: ${{ github.token }}
          
        run: |
          REPO="${{ github.event.inputs.workingOrgs }}"
          workflows=$(curl -s \
            -H "Authorization: token $GH_TOKEN" \
            https://api.github.com/repos/$REPO/actions/workflows)

          echo "$workflows" | jq -r '.workflows[] | select(.state=="disabled_inactivity") | .id' |
          while read id; do
            echo "Re-enabling workflow $id"
            curl -X PUT \
              -H "Authorization: token $GH_TOKEN" \
              https://api.github.com/repos/$REPO/actions/workflows/$id/enable
          done
